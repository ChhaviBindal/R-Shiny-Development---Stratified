---
title: '2341425'
output: html_document
date: "2025-12-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

```{r}
# Project: Stratified Sampling Allocation Estimator
# Purpose: Determine sample size (n) and stratum allocation (nh) under:
#          1. Proportional Allocation
#          2. Neyman Allocation
#          3. Optimum Allocation (Cost/Time constrained)

# 1. Setup Data 

# Simulating a population with 4 Strata
# Nh: Stratum Size, Sh: Std Dev, Ch: Cost per unit, Th: Time per unit
strata_data <- data.frame(
  Stratum = c(1, 2, 3, 4),
  Nh = c(4000, 3000, 2000, 1000), 
  Sh = c(10, 20, 30, 40),         
  Ch = c(4, 6, 8, 10),           
  Th = c(1, 1.5, 2, 2.5)          
)

# Global Parameters
N <- sum(strata_data$Nh)         
E <- 1.5                          
Z <- 1.96                         
V_target <- (E / Z)^2           

# Calculate Weight (Wh)
strata_data$Wh <- strata_data$Nh / N

# 2. Functions for Allocation 

# Method A: Proportional Allocation
# Formula: nh = n * Wh
# n = Sum(Wh * Sh^2) / (V + (1/N)*Sum(Wh * Sh^2))
calc_proportional <- function(data, V, N) {
  numerator <- sum(data$Wh * data$Sh^2)
  denominator <- V + (1/N) * numerator
  n <- numerator / denominator
  
  data$n_prop <- round(n * data$Wh)
  return(list(n_total = ceiling(n), allocation = data[, c("Stratum", "n_prop")]))
}

# Method B: Neyman Allocation
# Formula: nh propto Nh * Sh
# n = (Sum(Wh * Sh))^2 / (V + (1/N)*Sum(Wh * Sh^2))
calc_neyman <- function(data, V, N) {
  numerator <- (sum(data$Wh * data$Sh))^2
  denominator <- V + (1/N) * sum(data$Wh * data$Sh^2)
  n <- numerator / denominator
  
  # Allocation weights
  alloc_weight <- (data$Nh * data$Sh) / sum(data$Nh * data$Sh)
  data$n_neyman <- round(n * alloc_weight)
  return(list(n_total = ceiling(n), allocation = data[, c("Stratum", "n_neyman")]))
}

# Method C: Optimum Allocation (Cost Based) 
# Formula: nh propto (Nh * Sh) / sqrt(Ch)
# Minimizes total cost for a fixed Variance (V)
calc_optimum <- function(data, V, N) {
  # Term 1: Sum(Wh * Sh * sqrt(Ch))
  term1 <- sum(data$Wh * data$Sh * sqrt(data$Ch))
  # Term 2: Sum(Wh * Sh / sqrt(Ch))
  term2 <- sum(data$Wh * data$Sh / sqrt(data$Ch))
  
  numerator <- term1 * term2
  denominator <- V + (1/N) * sum(data$Wh * data$Sh^2)
  n <- numerator / denominator
  
  # Allocation weights
  numerator_h <- (data$Nh * data$Sh) / sqrt(data$Ch)
  alloc_weight <- numerator_h / sum(numerator_h)
  
  data$n_optimum <- round(n * alloc_weight)
  return(list(n_total = ceiling(n), allocation = data[, c("Stratum", "Ch", "n_optimum")]))
}

# 3. Execution & Output 

res_prop <- calc_proportional(strata_data, V_target, N)
res_neyman <- calc_neyman(strata_data, V_target, N)
res_opt <- calc_optimum(strata_data, V_target, N)

cat("STRATIFIED SAMPLING ALLOCATION REPORT\n")
cat("Parameters:\n")
cat(sprintf("Population (N): %d\nTarget Error (e): %.2f\nConfidence (Z): %.2f\n", N, E, Z))

cat(sprintf("1. Proportional Allocation (Total n = %d)\n", res_prop$n_total))
print(res_prop$allocation, row.names = FALSE)

cat(sprintf("2. Neyman Allocation (Total n = %d)\n", res_neyman$n_total))
print(res_neyman$allocation, row.names = FALSE)

cat(sprintf("3. Optimum Allocation (Total n = %d)\n", res_opt$n_total))
cat("   *Optimized for variable Cost (Ch)*\n")
print(res_opt$allocation, row.names = FALSE)
```
